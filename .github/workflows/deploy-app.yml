name: Delpoy Application

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Deploy version"
        required: true
        default: "v1.0.0"
        type: string

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      
      - name: Create deployment package
        run: |
          zip -r deployment.zip . -x "*.git*" ".github/*"
      
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: deployment-package
          path: deployment.zip

  deploy-to-staging:
    needs: build
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v3
        with:
          name: deployment-package
      
      - name: Verify deployment package
        run: |
          echo "Verifying deployment package exists..."
          if (Test-Path deployment.zip) {
            echo "deployment.zip found successfully"
          } else {
            throw "deployment.zip not found"
          }
          echo "Deploying version ${{ github.event.inputs.version }} to staging"
          # Add your deployment script here    

  deploy-to-production:
    runs-on: ubuntu-latest
    environment: production
    needs: deploy-to-staging
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v3
        with:
          name: deployment-package
      
      - name: Verify deployment package
        run: |
          echo "Verifying deployment package exists..."
          if (Test-Path deployment.zip) {
            echo "deployment.zip found successfully"
          } else {
            throw "deployment.zip not found"
          }
          echo "Deploying version ${{ github.event.inputs.version }} to production"
          # Add your deployment script here



