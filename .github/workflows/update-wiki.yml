name: Update Wiki Log

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
      run_number:
        required: true
        type: string
      actor:
        required: true
        type: string
      version:
        required: true
        type: string
    secrets:
      WIKI_TOKEN:
        required: true

jobs:
  update-wiki:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout wiki
        uses: actions/checkout@v4
        with:
          repository: ${{github.repository}}.wiki
          path: wiki
          token: ${{ secrets.WIKI_TOKEN }}
      
      - name: Update deployment log
        env:
          GITHUB_TOKEN: ${{ secrets.WIKI_TOKEN }}
        run: |
          cd wiki
          echo "| $(date -u '+%Y-%m-%d %H:%M:%S UTC') | ${{ inputs.environment }} | ${{ inputs.run_number }} | ${{ inputs.actor }} |" >> Deployment-Log.md
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.wiki.git
          git add Deployment-Log.md
          git commit -m "Log ${{ inputs.environment }} deployment #${{ inputs.run_number }} for version ${{ inputs.version }}"
          git push
